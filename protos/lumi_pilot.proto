syntax = "proto3";

package lumi_pilot;

// Lumi Pilot AI服务
service LumiPilotService {
  // AI对话
  rpc Chat(ChatRequest) returns (ChatResponse);
  
  // 3D打印机监控：一次完整的截图+分析流程
  rpc MonitorPrinter(PrinterMonitorRequest) returns (PrinterMonitorResponse);
}

// 对话请求
message ChatRequest {
  string message = 1;                    // 用户消息
}

// 对话响应
message ChatResponse {
  bool success = 1;                      // 是否成功
  string message = 2;                    // AI回复内容
  string error = 3;                      // 错误信息
  ResponseMetadata metadata = 4;         // 元数据
}

// 响应元数据
message ResponseMetadata {
  string request_id = 1;                 // 请求ID
  string model = 2;                      // 模型名称
  double duration = 3;                   // 处理时长(秒)
  string timestamp = 4;                  // 时间戳
}

// 3D打印机监控请求
message PrinterMonitorRequest {
  string camera_url = 1;                 // 摄像头URL（可选，不提供则使用配置文件中的默认值）
}

// 3D打印机监控响应
message PrinterMonitorResponse {
  bool success = 1;                      // 是否成功
  bool has_issues = 2;                   // 是否有问题
  string status = 3;                     // 打印状态：正常/需关注/需立即处理
  string issue = 4;                      // 发现的问题描述（单个最严重问题）
  string suggestion = 5;                 // 处理建议
  string confidence = 6;                 // 置信度：高/中/低
  string printer_status = 7;             // 打印机工作状态：printing/idle/error
  string summary = 8;                    // AI分析总结
  string timestamp = 9;                  // ISO格式时间戳
  bool image_captured = 10;              // 是否成功截取图片
  string analysis_model = 11;            // 使用的分析模型
  string error = 12;                     // 错误信息（失败时）
  PrinterMonitorMetadata metadata = 13;  // 监控元数据
}

// 打印机监控元数据
message PrinterMonitorMetadata {
  string request_id = 1;                 // 请求ID
  double duration = 2;                   // 处理时长(秒)
  string timestamp = 3;                  // 时间戳
  string camera_url = 4;                 // 实际使用的摄像头URL
  int64 image_size = 5;                  // 截图大小(bytes)
  bool debug_mode = 6;                   // 是否开启调试模式
  string debug_image_file = 7;           // 调试截图文件路径（调试模式下）
  string debug_result_file = 8;          // 调试分析文件路径（调试模式下）
}