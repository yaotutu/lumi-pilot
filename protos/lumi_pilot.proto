syntax = "proto3";

package lumi_pilot;

// Lumi Pilot AI服务
service LumiPilotService {
  // AI对话
  rpc Chat(ChatRequest) returns (ChatResponse);
  
  // 3D打印机监控：一次完整的截图+分析流程
  rpc MonitorPrinter(PrinterMonitorRequest) returns (PrinterMonitorResponse);
}

// 对话请求
message ChatRequest {
  string message = 1;                    // 用户消息
}

// 对话响应
message ChatResponse {
  bool success = 1;                      // 是否成功
  string message = 2;                    // AI回复内容
  string error = 3;                      // 错误信息
  ResponseMetadata metadata = 4;         // 元数据
}

// 响应元数据
message ResponseMetadata {
  string request_id = 1;                 // 请求ID
  string model = 2;                      // 模型名称
  double duration = 3;                   // 处理时长(秒)
  string timestamp = 4;                  // 时间戳
}

// 3D打印机监控请求
message PrinterMonitorRequest {
  string camera_url = 1;                 // 摄像头URL（可选，不提供则使用配置文件中的默认值）
}

// 3D打印机监控响应
//
// ======== success 字段详细说明 ========
//
// true (成功): 整个监控流程成功完成
//   - 摄像头截图成功
//   - AI模型分析成功
//   - 分析结果生成成功
//   - 此时所有字段包含有效数据，error为空
//   - 客户端可正常解析并展示分析结果
//   示例: success=true, has_issues=true, status="需关注",
//         issue="检测到打印件边缘有轻微翘边"
//
// false (失败): 监控流程执行过程中发生错误
//   常见失败原因:
//     1. 无法连接摄像头 (网络问题、URL错误)
//     2. 截图失败 (摄像头离线、权限不足)
//     3. AI分析失败 (模型调用超时、API错误)
//     4. 服务内部异常 (代码逻辑错误)
//   - error字段包含具体错误信息
//   - 其他字段为默认值或空值
//   - printer_status设为"error"
//   - image_captured为false
//   示例: success=false, error="无法连接到摄像头: http://192.168.1.100:8080/video",
//         printer_status="error", image_captured=false
//
// 客户端处理建议:
//   if (success == true) {
//     // 解析并展示分析结果
//     显示: status, issue, suggestion, summary等
//   } else {
//     // 展示错误信息并提示用户
//     显示: error字段内容
//     提示: "请检查摄像头连接或稍后重试"
//   }
//
message PrinterMonitorResponse {
  bool success = 1;                      // 监控流程是否成功完成 (详见上方说明)
  bool has_issues = 2;                   // 是否检测到打印问题 (success=true时有效; success=false时通常为true表示监控本身有问题)
  string issue = 3;                      // 发现的问题描述，单个最严重问题 (success=true时有效)
  string suggestion = 4;                 // 处理建议 (success=true时有效)
  string confidence = 5;                 // 分析置信度: 高/中/低 (success=true时有效)
  string summary = 6;                    // AI分析总结 (success=true时有效)
  string timestamp = 7;                  // ISO格式时间戳
  string error = 8;                      // 错误信息 (success=false时包含具体错误原因; success=true时为空)
}